<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZAM-AI Chat Assistant</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github-dark.min.css">
    <style>
        :root {
            --primary-bg: #1a1a2e;
            --secondary-bg: #16213e;
            --text-color: #e6e6e6;
            --ai-bubble: #0f3460;
            --user-bubble: #4e4e8d;
            --accent-1: #533483;
            --accent-2: #e94560;
            --input-bg: #1f4068;
            --code-bg: #1a1a2a;
            --code-border: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--primary-bg) 0%, var(--secondary-bg) 100%);
            color: var(--text-color);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background-color: var(--accent-1);
            padding: 1.2rem;
            text-align: center;
            border-bottom: 3px solid var(--accent-2);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .header h1 {
            font-size: 1.8rem;
            background: linear-gradient(90deg, #ff6b9e, #6bb9ff, #7fffd4);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .header p {
            font-size: 1rem;
            margin-top: 0.3rem;
            opacity: 0.8;
        }

        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.2rem;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .message {
            max-width: 80%;
            padding: 1rem 1.2rem;
            border-radius: 1.2rem;
            line-height: 1.5;
            position: relative;
            animation: fadeIn 0.4s ease;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .ai-message {
            align-self: flex-start;
            background: linear-gradient(135deg, var(--ai-bubble) 0%, #1a3a5f 100%);
            border-bottom-left-radius: 0.3rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-message {
            align-self: flex-end;
            background: linear-gradient(135deg, var(--user-bubble) 0%, #3d3d7a 100%);
            border-bottom-right-radius: 0.3rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .message-time {
            font-size: 0.75rem;
            opacity: 0.7;
            margin-top: 0.5rem;
            text-align: right;
        }

        .ai-name {
            color: #7fffd4;
            font-weight: bold;
            margin-bottom: 0.4rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-name {
            color: #6bb9ff;
            font-weight: bold;
            margin-bottom: 0.4rem;
            text-align: right;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        .input-area {
            display: flex;
            padding: 1.2rem;
            background-color: var(--secondary-bg);
            border-top: 2px solid var(--accent-1);
            gap: 0.8rem;
            position: sticky;
            bottom: 0;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .message-input {
            flex: 1;
            padding: 1rem 1.2rem;
            border-radius: 2rem;
            border: none;
            background-color: var(--input-bg);
            color: var(--text-color);
            outline: none;
            font-size: 1rem;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .message-input:focus {
            box-shadow: 0 0 0 2px var(--accent-2), inset 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .send-button, .upload-button {
            background: linear-gradient(135deg, var(--accent-2) 0%, #ff4b7d 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 3.2rem;
            height: 3.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .upload-button {
            background: linear-gradient(135deg, var(--accent-1) 0%, #634a8c 100%);
        }

        .send-button:hover, .upload-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4);
        }

        .send-button:active, .upload-button:active {
            transform: translateY(0);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .send-button.loading {
            opacity: 0.8;
            pointer-events: none;
        }

        #file-input {
            display: none;
        }

        .typing-indicator {
            display: inline-flex;
            gap: 0.4rem;
            align-items: center;
            padding: 0.8rem 1.2rem;
            background-color: var(--ai-bubble);
            border-radius: 1.2rem;
            align-self: flex-start;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .typing-dot {
            width: 0.6rem;
            height: 0.6rem;
            background-color: #7fffd4;
            border-radius: 50%;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(1) {
            animation-delay: 0s;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-0.3rem); }
        }

        /* Markdown styles */
        .markdown-content {
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .markdown-content h1, 
        .markdown-content h2, 
        .markdown-content h3, 
        .markdown-content h4, 
        .markdown-content h5, 
        .markdown-content h6 {
            margin: 0.5rem 0;
            color: #7fffd4;
        }

        .markdown-content p {
            margin: 0.5rem 0;
        }

        .markdown-content ul, 
        .markdown-content ol {
            margin: 0.5rem 0;
            padding-left: 1.5rem;
        }

        .markdown-content li {
            margin: 0.2rem 0;
        }

        .markdown-content strong {
            color: #ff6b9e;
        }

        .markdown-content em {
            color: #6bb9ff;
            font-style: italic;
        }

        .markdown-content a {
            color: #6bb9ff;
            text-decoration: underline;
        }

        .markdown-content blockquote {
            border-left: 3px solid #ff6b9e;
            padding-left: 1rem;
            margin: 0.5rem 0;
            color: #aaa;
        }

        /* Code block styles */
        .code-block-container {
            position: relative;
            margin: 0.8rem 0;
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .code-block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--code-bg);
            padding: 0.3rem 0.5rem;
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
            border: 1px solid var(--code-border);
            border-bottom: none;
        }

        .code-block-language {
            font-size: 0.8rem;
            color: #7fffd4;
            font-family: monospace;
        }

        .code-block-copy {
            background-color: var(--secondary-bg);
            color: var(--text-color);
            border: none;
            border-radius: 0.3rem;
            padding: 0.2rem 0.5rem;
            font-size: 0.7rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.3rem;
            transition: all 0.2s;
        }

        .code-block-copy:hover {
            background-color: #ff6b9e;
        }

        .code-block-copy.copied {
            background-color: #7fffd4;
            color: #000;
        }

        .code-block {
            background-color: var(--code-bg);
            padding: 1rem;
            border: 1px solid var(--code-border);
            border-bottom-left-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .inline-code {
            background-color: var(--code-bg);
            padding: 0.2rem 0.4rem;
            border-radius: 0.3rem;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9rem;
            border: 1px solid var(--code-border);
        }

        /* Image upload styles */
        .uploaded-image {
            max-width: 100%;
            border-radius: 0.5rem;
            margin: 0.5rem 0;
        }

        .image-message {
            font-style: italic;
            color: #6bb9ff;
            margin: 0.3rem 0;
        }

        /* Error message */
        .error-message {
            color: #ff6b6b;
            text-align: center;
            padding: 0.5rem;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .message {
                max-width: 90%;
            }
            
            .header h1 {
                font-size: 1.2rem;
            }
            
            .input-area {
                padding: 0.8rem;
            }
            
            .send-button, .upload-button {
                width: 2.8rem;
                height: 2.8rem;
            }
        }

        @media (max-width: 480px) {
            .message {
                max-width: 95%;
                padding: 0.7rem;
            }
            
            .chat-container {
                padding: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>ZAM AI Assistant</h1>
        <p>AI-powered assistant untuk membantu Anda</p>
    </div>

    <div class="chat-container" id="chat-container">
        <!-- Messages will be added here dynamically -->
    </div>

    <div class="input-area">
        <button class="upload-button" id="upload-button" title="Upload Image">
            <i class="fas fa-image"></i>
        </button>
        <input type="file" id="file-input" accept="image/*">
        <input type="text" class="message-input" id="message-input" placeholder="Ketik pesan Anda..." autocomplete="off">
        <button class="send-button" id="send-button">
            <i class="fas fa-paper-plane"></i>
        </button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/html.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/css.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/json.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/bash.min.js"></script>

    <script>
        const Aiprompt = "Kamu adalah ZAM AI, asisten AI yang sangat cerdas dan responsif. Tugasmu adalah memberikan jawaban yang informatif, relevan, dan mudah dipahami. Kamu harus selalu menjaga nada percakapan yang profesional dan sopan. Jika pengguna mengirimkan gambar, kamu harus mencoba menjelaskan isi gambar tersebut dengan cara yang jelas dan ringkas.";
        
        document.addEventListener('DOMContentLoaded', function() {
            const chatContainer = document.getElementById('chat-container');
            const messageInput = document.getElementById('message-input');
            const sendButton = document.getElementById('send-button');
            const uploadButton = document.getElementById('upload-button');
            const fileInput = document.getElementById('file-input');

            marked.setOptions({
                breaks: true,
                highlight: function(code, lang) {
                    const language = hljs.getLanguage(lang) ? lang : 'plaintext';
                    return hljs.highlight(code, { language }).value;
                }
            });

            // Add welcome message
            addMessage('ai', 'Halo! Saya ZAM AI Assistant. Ada yang bisa saya bantu?');

            // Event listeners
            sendButton.addEventListener('click', sendMessage);
            
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });

            uploadButton.addEventListener('click', function() {
                fileInput.click();
            });

            fileInput.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    uploadImage(e.target.files[0]);
                }
            });

            function sendMessage() {
                const message = messageInput.value.trim();
                if (message) {
                    addMessage('user', message);
                    messageInput.value = '';
                    
                    // Show loading state
                    sendButton.classList.add('loading');
                    sendButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

                    const typingIndicator = document.createElement('div');
                    typingIndicator.className = 'typing-indicator';
                    typingIndicator.innerHTML = `
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    `;
                    chatContainer.appendChild(typingIndicator);
                    chatContainer.scrollTop = chatContainer.scrollHeight;

                    callAI(message);
                }
            }

            function uploadImage(file) {
                // For GitHub Pages, we can only show the file name since we can't upload to a server
                addMessage('user', `[Gambar: ${file.name}]`);
                
                // Show typing indicator
                const typingIndicator = document.createElement('div');
                typingIndicator.className = 'typing-indicator';
                typingIndicator.innerHTML = `
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                `;
                chatContainer.appendChild(typingIndicator);
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
                // Call AI with image info
                callAI(`Saya mengupload gambar: ${file.name}`);
                
                // Reset file input
                fileInput.value = '';
            }

            function addMessage(sender, content) {
                const messageDiv = document.createElement('div');
                const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

                let processedContent = content;
                if (sender === 'ai') {
                    processedContent = marked.parse(content);
                } else {
                    processedContent = escapeHtml(content);
                }

                if (sender === 'ai') {
                    messageDiv.className = 'message ai-message';
                    messageDiv.innerHTML = `
                        <div class="ai-name"><i class="fas fa-robot"></i> ZAM-AI</div>
                        <div class="markdown-content">${processedContent}</div>
                        <div class="message-time">${time}</div>
                    `;
                } else {
                    messageDiv.className = 'message user-message';
                    messageDiv.innerHTML = `
                        <div class="user-name"><i class="fas fa-user"></i> You</div>
                        <div>${processedContent}</div>
                        <div class="message-time">${time}</div>
                    `;
                }

                // Remove any existing typing indicators
                const typingIndicators = document.querySelectorAll('.typing-indicator');
                typingIndicators.forEach(indicator => indicator.remove());

                chatContainer.appendChild(messageDiv);

                // Process code blocks for AI messages
                if (sender === 'ai') {
                    processCodeBlocks(messageDiv);
                }

                chatContainer.scrollTop = chatContainer.scrollHeight;
            }

            function escapeHtml(unsafe) {
                return unsafe
                    .replace(/&/g, "&amp;")
                    .replace(/</g, "&lt;")
                    .replace(/>/g, "&gt;")
                    .replace(/"/g, "&quot;")
                    .replace(/'/g, "&#039;");
            }

            function processCodeBlocks(messageDiv) {
                const codeBlocks = messageDiv.querySelectorAll('pre code');
                codeBlocks.forEach((codeBlock) => {
                    const pre = codeBlock.parentElement;
                    const container = document.createElement('div');
                    container.className = 'code-block-container';

                    let language = 'plaintext';
                    if (codeBlock.className) {
                        const langMatch = codeBlock.className.match(/language-(\w+)/);
                        if (langMatch) {
                            language = langMatch[1];
                        }
                    }

                    const header = document.createElement('div');
                    header.className = 'code-block-header';
                    header.innerHTML = `
                        <span class="code-block-language">${language}</span>
                        <button class="code-block-copy">
                            <i class="fas fa-copy"></i>
                            Copy
                        </button>
                    `;

                    pre.parentNode.insertBefore(container, pre);
                    container.appendChild(header);
                    container.appendChild(pre);

                    const copyButton = container.querySelector('.code-block-copy');
                    copyButton.addEventListener('click', function() {
                        navigator.clipboard.writeText(codeBlock.textContent).then(() => {
                            copyButton.innerHTML = '<i class="fas fa-check"></i> Copied!';
                            copyButton.classList.add('copied');
                            setTimeout(() => {
                                copyButton.innerHTML = '<i class="fas fa-copy"></i> Copy';
                                copyButton.classList.remove('copied');
                            }, 2000);
                        }).catch(err => {
                            console.error('Failed to copy: ', err);
                        });
                    });

                    pre.className = 'code-block';
                    hljs.highlightElement(codeBlock);
                });

                // Process inline code
                const inlineCodeElements = messageDiv.querySelectorAll('code:not(pre code)');
                inlineCodeElements.forEach((codeElement) => {
                    const span = document.createElement('span');
                    span.className = 'inline-code';
                    span.textContent = codeElement.textContent;
                    codeElement.parentNode.replaceChild(span, codeElement);
                });
            }

            function callAI(message, imageUrl = null) {
                let apiUrl = `https://fastrestapis.fasturl.link/aillm/gpt-4o?ask=${encodeURIComponent(message)}&style=${encodeURIComponent(Aiprompt)}&sessionId=zam-${Date.now()}`;

                if (imageUrl) {
                    apiUrl += `&imageUrl=${encodeURIComponent(imageUrl)}`;
                }

                // Add timeout to the fetch request
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000);

                fetch(apiUrl, { signal: controller.signal })
                    .then(response => {
                        clearTimeout(timeoutId);
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        // Remove loading state
                        sendButton.classList.remove('loading');
                        sendButton.innerHTML = '<i class="fas fa-paper-plane"></i>';

                        if (data.status === 200) {
                            addMessage('ai', data.result);
                        } else {
                            addMessage('ai', "Maaf, saya tidak dapat memproses permintaan Anda. Silakan coba lagi.");
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        
                        // Remove loading state
                        sendButton.classList.remove('loading');
                        sendButton.innerHTML = '<i class="fas fa-paper-plane"></i>';
                        
                        if (error.name === 'AbortError') {
                            addMessage('ai', "Maaf, permintaan Anda mengalami timeout. Silakan coba lagi.");
                        } else {
                            addMessage('ai', "Maaf, terjadi kesalahan jaringan. Silakan periksa koneksi internet Anda dan coba lagi.");
                        }
                    });
            }
        });
    </script>
</body>
</html>